"use strict";(()=>{var e={};e.id=540,e.ids=[540],e.modules={2934:e=>{e.exports=require("next/dist/client/components/action-async-storage.external.js")},4580:e=>{e.exports=require("next/dist/client/components/request-async-storage.external.js")},5869:e=>{e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},6113:e=>{e.exports=require("crypto")},2221:(e,t,r)=>{r.r(t),r.d(t,{headerHooks:()=>g,originalPathname:()=>v,patchFetch:()=>E,requestAsyncStorage:()=>p,routeModule:()=>_,serverHooks:()=>h,staticGenerationAsyncStorage:()=>m,staticGenerationBailout:()=>y});var a={};r.r(a),r.d(a,{GET:()=>f});var n=r(5419),i=r(9108),s=r(9678),o=r(1664),c=r(8615),u=r(4776),d=r(867),l=r(7439);async function f(e){let t=e.nextUrl.searchParams,r=t.get("code");if(t.get("error")||!r)return(0,d.redirect)("/dashboard/settings?error=meta_auth_failed");try{let e=await (0,o.e)(),{data:{user:t}}=await e.auth.getUser(),a=(0,l.cookies)().get("dev_session");if(!t&&a&&(t={id:"mock_user_id_dev"}),!t)return(0,d.redirect)("/login");let n=await (0,c.p$)(r),i=(0,u.H)(n);if("mock_user_id_dev"!==t.id){let{error:r}=await e.from("integrations").upsert({user_id:t.id,platform:"meta",access_token_ref:i,status:"active",updated_at:new Date().toISOString()},{onConflict:"user_id, platform"});if(r)throw r}else(0,l.cookies)().set("dev_meta_token",i,{httpOnly:!0,path:"/"})}catch(e){if("NEXT_REDIRECT"===e.message)throw e;return console.error("Meta Auth Error:",e),(0,d.redirect)("/dashboard/settings?error=meta_exchange_failed")}return(0,d.redirect)("/dashboard/settings/select-account")}let _=new n.AppRouteRouteModule({definition:{kind:i.x.APP_ROUTE,page:"/api/auth/meta/callback/route",pathname:"/api/auth/meta/callback",filename:"route",bundlePath:"app/api/auth/meta/callback/route"},resolvedPagePath:"C:\\Users\\ojuli\\AIOS\\meu-projeto\\app\\api\\auth\\meta\\callback\\route.ts",nextConfigOutput:"",userland:a}),{requestAsyncStorage:p,staticGenerationAsyncStorage:m,serverHooks:h,headerHooks:g,staticGenerationBailout:y}=_,v="/api/auth/meta/callback/route";function E(){return(0,s.patchFetch)({serverHooks:h,staticGenerationAsyncStorage:m})}},8615:(e,t,r)=>{r.d(t,{N6:()=>i,_z:()=>c,cE:()=>o,gt:()=>u,lz:()=>d,on:()=>l,p$:()=>s});let a="v19.0",n="https://graph.facebook.com";function i(e){let t=process.env.META_APP_ID?.trim()||"",r=process.env.META_REDIRECT_URI?.trim()||"",n=new URLSearchParams({client_id:t,redirect_uri:r,state:e,scope:"email,ads_management,ads_read,business_management",response_type:"code"});return`https://www.facebook.com/${a}/dialog/oauth?${n.toString()}`}async function s(e){let t=process.env.META_APP_ID?.trim()||"",r=process.env.META_APP_SECRET?.trim()||"",i=process.env.META_REDIRECT_URI?.trim()||"",s=new URLSearchParams({client_id:t,client_secret:r,redirect_uri:i,code:e}),o=await fetch(`${n}/${a}/oauth/access_token?${s.toString()}`),c=await o.json();if(c.error)throw Error(c.error.message);return c.access_token}async function o(e){let t=await fetch(`${n}/${a}/me/adaccounts?fields=id,name,account_id,currency&access_token=${e}`),r=(await t.json()).data||[];try{let t=`${n}/${a}/me/businesses?fields=id,name,owned_ad_accounts{id,name,account_id,currency},client_ad_accounts{id,name,account_id,currency}&access_token=${e}`,i=await fetch(t),s=await i.json();s.data&&s.data.forEach(e=>{e.owned_ad_accounts?.data&&r.push(...e.owned_ad_accounts.data),e.client_ad_accounts?.data&&r.push(...e.client_ad_accounts.data)})}catch(e){}return Array.from(new Map(r.map(e=>[e.id,e])).values())}async function c(e,t){let r=await fetch(`${n}/${a}/${e}/campaigns?fields=id,name,status,objective,daily_budget,lifetime_budget,created_time&access_token=${t}`),i=await r.json();if(i.error)throw Error(i.error.message);return i.data||[]}async function u(e,t){let r=await fetch(`${n}/${a}/${e}/adsets?fields=id,name,status,billing_event,bid_amount,daily_budget,lifetime_budget&access_token=${t}`),i=await r.json();if(i.error)throw Error(i.error.message);return i.data||[]}async function d(e,t){let r=await fetch(`${n}/${a}/${e}/adcreatives?fields=id,name,title,body,object_story_spec&access_token=${t}&limit=10`),i=await r.json();if(i.error)throw Error(i.error.message);return i.data||[]}async function l(e,t,r="maximum",i,s){let o;let c="spend,impressions,clicks,cpc,cpm,actions,conversions,purchase_roas,date_start",u=Array.isArray(e)?e.join(","):e;o=Array.isArray(e)&&e.length>1?`${n}/${a}/?ids=${u}&fields=insights{${c}${s?`,time_increment=${s}`:""}}&access_token=${t}`:`${n}/${a}/${u}/insights?fields=${c}&access_token=${t}${s?`&time_increment=${s}`:""}`,i?o+=`&time_range=${JSON.stringify(i)}`:o+=`&date_preset=${r}`;let d=await fetch(o),l=await d.json();if(l.error)throw Error(l.error.message);return Array.isArray(e)&&e.length>1?Object.values(l).map(e=>e.insights?.data?.[0]).filter(Boolean):l.data||[]}},4776:(e,t,r)=>{r.d(t,{H:()=>s,p:()=>o});var a=r(6113);let n="aes-256-gcm",i=(0,a.createHash)("sha256").update(process.env.SUPABASE_SERVICE_ROLE_KEY||"fallback_dev_key").digest(),s=e=>{let t=(0,a.randomBytes)(12),r=(0,a.createCipheriv)(n,Buffer.from(i),t),s=r.update(e,"utf8","hex");s+=r.final("hex");let o=r.getAuthTag().toString("hex");return`${t.toString("hex")}:${o}:${s}`},o=e=>{let[t,r,s]=e.split(":");if(!t||!r||!s)throw Error("Invalid encrypted text format");let o=(0,a.createDecipheriv)(n,Buffer.from(i),Buffer.from(t,"hex"));return o.setAuthTag(Buffer.from(r,"hex")),o.update(s,"hex","utf8")+o.final("utf8")}},1664:(e,t,r)=>{r.d(t,{e:()=>i});var a=r(6496),n=r(7439);async function i(){let e=(0,n.cookies)();return(0,a.createServerClient)("https://sisydugbdmlsqvgikpyd.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InNpc3lkdWdiZG1sc3F2Z2lrcHlkIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzEyODc0ODUsImV4cCI6MjA4Njg2MzQ4NX0.0MFDsfQZ5VlrKcZdAHGJXFemCxTteKIxtQ9Bnf7ByXQ",{cookies:{get:t=>e.get(t)?.value,set(t,r,a){try{e.set({name:t,value:r,...a})}catch(e){}},remove(t,r){try{e.set({name:t,value:"",...r})}catch(e){}}}})}},8096:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),function(e,t){for(var r in t)Object.defineProperty(e,r,{enumerable:!0,get:t[r]})}(t,{DynamicServerError:function(){return a},isDynamicServerError:function(){return n}});let r="DYNAMIC_SERVER_USAGE";class a extends Error{constructor(e){super("Dynamic server usage: "+e),this.description=e,this.digest=r}}function n(e){return"object"==typeof e&&null!==e&&"digest"in e&&"string"==typeof e.digest&&e.digest===r}("function"==typeof t.default||"object"==typeof t.default&&null!==t.default)&&void 0===t.default.__esModule&&(Object.defineProperty(t.default,"__esModule",{value:!0}),Object.assign(t.default,t),e.exports=t.default)},2973:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),function(e,t){for(var r in t)Object.defineProperty(e,r,{enumerable:!0,get:t[r]})}(t,{isStaticGenBailoutError:function(){return o},staticGenerationBailout:function(){return u}});let a=r(8096),n=r(5869),i="NEXT_STATIC_GEN_BAILOUT";class s extends Error{constructor(...e){super(...e),this.code=i}}function o(e){return"object"==typeof e&&null!==e&&"code"in e&&e.code===i}function c(e,t){let{dynamic:r,link:a}=t||{};return"Page"+(r?' with `dynamic = "'+r+'"`':"")+" couldn't be rendered statically because it used `"+e+"`."+(a?" See more info here: "+a:"")}let u=(e,t)=>{let{dynamic:r,link:i}=void 0===t?{}:t,o=n.staticGenerationAsyncStorage.getStore();if(!o)return!1;if(o.forceStatic)return!0;if(o.dynamicShouldError)throw new s(c(e,{link:i,dynamic:null!=r?r:"error"}));let u=c(e,{dynamic:r,link:"https://nextjs.org/docs/messages/dynamic-server-error"});if(null==o.postpone||o.postpone.call(o,e),o.revalidate=0,o.isStaticGeneration){let t=new a.DynamicServerError(u);throw o.dynamicUsageDescription=e,o.dynamicUsageStack=t.stack,t}return!1};("function"==typeof t.default||"object"==typeof t.default&&null!==t.default)&&void 0===t.default.__esModule&&(Object.defineProperty(t.default,"__esModule",{value:!0}),Object.assign(t.default,t),e.exports=t.default)},482:(e,t,r)=>{e.exports=r(399)},2:(e,t,r)=>{e.exports=r(482).vendored["react-rsc"].React},5419:(e,t,r)=>{e.exports=r(517)},5458:(e,t)=>{function r(e){return"("===e[0]&&e.endsWith(")")}Object.defineProperty(t,"__esModule",{value:!0}),function(e,t){for(var r in t)Object.defineProperty(e,r,{enumerable:!0,get:t[r]})}(t,{isGroupSegment:function(){return r},PAGE_SEGMENT_KEY:function(){return a},DEFAULT_SEGMENT_KEY:function(){return n}});let a="__PAGE__",n="__DEFAULT__"},6783:(e,t,r)=>{function a(e){return e&&e.__esModule?e:{default:e}}r.r(t),r.d(t,{_:()=>a,_interop_require_default:()=>a})}};var t=require("../../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),a=t.X(0,[456,320,867],()=>r(2221));module.exports=a})();